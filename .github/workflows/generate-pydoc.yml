# .github/workflows/generate-pydoc.yml
name: üìù Generate full Pydoc

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Setup Python üêç
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: pip install -r requirements.txt

    - name: Generate Pydoc for all modules
      run: |
        mkdir -p docs
        # Per a cada .py dins de blog/, genera HTML
        find blog -name '*.py' \
          | sed -e 's|/|.|g' -e 's|\.py$||' \
          | grep -v '__init__$' \
          | while read module; do
              echo "Generating $module"
              python -m pydoc -w "$module"
              # El HTML surt com a module.html
              fname="${module##*.}.html"
              mv "$fname" "docs/$fname"
            done
        # Finalment, el package index
        python -m pydoc -w blog
        mv blog.html docs/index.html

    - name: Deploy to GitHub Pages üåê
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: docs
